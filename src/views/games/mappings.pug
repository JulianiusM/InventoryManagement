extends ../layout

block meta
    title Mapping Queue | Inventory Management

block content
    - const mappings = (data && data.mappings) ? data.mappings : []
    - const titles = (data && data.titles) ? data.titles : []
    - const providerLabels = {steam: 'Steam', epic: 'Epic Games', gog: 'GOG', xbox: 'Xbox', playstation: 'PlayStation', nintendo: 'Nintendo', origin: 'Origin', ubisoft: 'Ubisoft', other: 'Other'}

    #liveAlerts

    .d-flex.justify-content-between.align-items-center.mb-3.flex-wrap.gap-2
        h1.h3.mb-0.text-white
            i.bi.bi-link-45deg.me-2
            | Mapping Queue
            if mappings.length > 0
                span.badge.text-bg-warning.ms-2.fs-6 #{mappings.length} pending

    //- Info card
    .card.text-bg-dark.border-secondary.mb-3
        .card-body
            i.bi.bi-info-circle.me-2
            | Games synced from external accounts that couldn't be automatically matched appear here. Map them to existing game titles or ignore them.

    //- Mappings list
    if mappings.length === 0
        .card.text-bg-dark.border-secondary
            .card-body.text-center.py-5
                i.bi.bi-check-circle.display-1.text-success.mb-3.d-block
                p.text-white-50.mb-0 All synced games have been mapped! No pending items.
    else
        .table-responsive
            table.table.table-dark.table-hover.align-middle
                thead
                    tr
                        th Provider
                        th External Game
                        th Map To
                        th.text-end Actions
                tbody
                    each mapping in mappings
                        tr
                            td
                                span.badge.text-bg-info #{providerLabels[mapping.provider] || mapping.provider}
                            td
                                strong.text-white #{mapping.externalGameName || mapping.externalGameId}
                                .small.text-white-50 ID: #{mapping.externalGameId}
                            td
                                form.d-flex.gap-2.align-items-center(method="post" action=`/games/mappings/${mapping.id}` id=`mapForm-${mapping.id}`)
                                    input(type="hidden" name="action" value="map")
                                    select.form-select.form-select-sm.text-bg-dark.border-secondary(name="gameTitleId" style="max-width: 200px")
                                        option(value="") Select game...
                                        each t in titles
                                            option(value=t.id) #{t.name}
                            td.text-end
                                .btn-group.btn-group-sm
                                    button.btn.btn-outline-success(type="submit" form=`mapForm-${mapping.id}` title="Map to selected game")
                                        i.bi.bi-check-lg
                                    form.d-inline(method="post" action=`/games/mappings/${mapping.id}`)
                                        input(type="hidden" name="action" value="ignore")
                                        button.btn.btn-outline-secondary(type="submit" title="Ignore this game")
                                            i.bi.bi-x-lg
